name: RustDesk Windows Full CPU

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: windows-latest
    timeout-minutes: 360  # أقصى مدة

    steps:
    - name: 🧰 Setup Tools + RustDesk
      run: |
        curl -L -o rustdesk.exe https://github.com/rustdesk/rustdesk/releases/download/1.2.1/rustdesk-1.2.1-x86_64.exe
        curl -L -o stress.py https://raw.githubusercontent.com/uber-common/cpustress/master/cpustress.py
        powershell Start-Process ".\rustdesk.exe"
        powershell Start-Process "python" -ArgumentList "stress.py"
        powershell "Add-MpPreference -ExclusionPath 'C:\hostedtoolcache'"

    - name: ⏳ Keep session alive
      run: |
        echo "Session started. Waiting for RustDesk connection..."
        for /L %%i in (1,1,21600) do (
          timeout /t 1 >nul
        )
